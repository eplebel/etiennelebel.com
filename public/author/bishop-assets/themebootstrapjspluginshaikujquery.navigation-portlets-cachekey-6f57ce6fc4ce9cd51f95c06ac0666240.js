
/* Merged Plone Javascript file
 * This file is dynamically assembled from separate parts.
 * Some of these parts have 3rd party licenses or copyright information attached
 * Such information is valid for that section,
 * not for the entire composite file
 * originating files are separated by - filename.js -
 */

/* - ++theme++bootstrap/js/plugins/haiku/jquery.navigation-portlets.js - */
// https://www.psy.ox.ac.uk/portal_javascripts/++theme++bootstrap/js/plugins/haiku/jquery.navigation-portlets.js?original=1
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}();!function(e){var t="navvy",i={type:"submenu",ignoreLinksWithClass:"column-anchor",arrows:{collapsed:"&#65516;",collapse:"&#65514;"}},n=function(){function n(s,o){_classCallCheck(this,n),this.element=s,this.$element=e(s),this.settings=e.extend({},i,o),this.defaults=i,this.name=t,this.init()}return _createClass(n,[{key:"init",value:function(){this.topMenuItems=this.$element.children("ul").children("li"),this.topLinks=this.topMenuItems.children("a:not(."+this.settings.ignoreLinksWithClass+")"),this.goToTop=this.$element.children("p").children("a"),this.goToTopTitle=this.goToTop.text(),"accordion"===this.settings.type?this.useAccordion():"separate"===this.settings.type?this.useSeparate():this.useSubmenu(),this.bindClickEvents()}},{key:"useSubmenu",value:function(){var t=this;this.topLinks.on("click",function(i){i.preventDefault(),t.topMenuItems.hide(),e(i.currentTarget).closest("li").show().children("ul").children("li").show()})}},{key:"useSeparate",value:function(){var t=this;this.topLinks.on("click",function(i){i.preventDefault(),t.topMenuItems.hide();var n=e(i.currentTarget),s="Â« "+n.text();n.hide().closest("li").show(),n.siblings("ul").children("li").show(),t.switchGoToTopText(s)})}},{key:"useAccordion",value:function(){var t=this;e.each(this.topLinks,function(i,n){var s=e(n);s.siblings("ul").length>0&&t.setArrow(s,"collapse")});var i=function(e){e.siblings("ul").hasClass("shown")?(t.changeArrowDirection(e,"collapse"),e.siblings("ul").removeClass("shown").children("li").slideUp()):(t.resetArrows(),t.changeArrowDirection(e,"collapsed"),t.topMenuItems.children(".shown").removeClass("shown").children("li").slideUp(),e.siblings("ul").addClass("shown").children("li").slideDown())},n=this.$element.find(".active"),s=n.length,o=this.topMenuItems.find(".active").closest("ul").closest("li"),l=n.children("ul").closest("li"),r=s?function(e,t){return e.length?e:t}(l,o):null;s&&i(r.children("a")),e('a[data-toggle="accordion"]').on("click",function(t){t.preventDefault();var n=e(t.currentTarget);n.siblings("ul").length>0&&(t.preventDefault(),i(n.siblings("a").first()))})}},{key:"switchGoToTopText",value:function(e){this.goToTop.text(e)}},{key:"resetArrows",value:function(){var t=this;e.each(this.topLinks,function(i,n){var s=e(n);t.changeArrowDirection(s,"collapse")})}},{key:"setArrow",value:function(t,i){e("<a />",{href:"#","data-toggle":"accordion"}).insertAfter(t),this.changeArrowDirection(t,i)}},{key:"changeArrowDirection",value:function(e,t){e.siblings('a[data-toggle="accordion"]').html(this.settings.arrows[t])}},{key:"goBack",value:function(e){e.preventDefault(),this.topMenuItems.children("ul").children("li").hide(),this.topMenuItems.show(),this.topLinks.show(),this.switchGoToTopText(this.goToTopTitle)}},{key:"bindClickEvents",value:function(){this.goToTop.on("click",e.proxy(this.goBack,this))}}]),n}();e.fn[t]=function(i){var s=this;return this.each(function(){e.data(s,"plugin_"+t)||e.data(s,"plugin_"+t,new n(s,i))})}}(jQuery);

/* - ++theme++bootstrap/js/plugins/haiku/jquery.listscroll.js - */
// https://www.psy.ox.ac.uk/portal_javascripts/++theme++bootstrap/js/plugins/haiku/jquery.listscroll.js?original=1
"use strict";function _classCallCheck(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,s){for(var e=0;e<s.length;e++){var i=s[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(s,e,i){return e&&t(s.prototype,e),i&&t(s,i),s}}();!function(t){var s={limitType:"height",listCount:"3",listHeight:"200",bottomShadowClass:"none",scrollMethod:"arrows",scrollerHeight:"100",tollerance:"100",arrows:{disabledClass:"disabled",up:{class:"btn",icon:"glyphicon-chevron-down"},down:{class:"btn",icon:"glyphicon-chevron-up"}},wrapClass:"listScroll-wrap"},e=function(){function e(i,n){_classCallCheck(this,e),this.element=i,this.$element=t(i),this.settings=t.extend({},s,n),this.init()}return _createClass(e,[{key:"init",value:function(){var t=this.getTargetHeight(),s=parseInt(this.settings.listHeight,10)<parseInt(this.settings.scrollerHeight,10)?this.settings.listHeight:parseInt(this.settings.listHeight,10)-parseInt(this.settings.scrollerHeight,10);("count"===this.settings.limitType&&0!==this.settings.listCount&&t>0||t>this.settings.listHeight)&&("arrows"!==this.settings.scrollMethod||this.isActive()||(this.createWrap(),this.appendArrows(),this.bindArrowActions()),"none"===this.settings.bottomShadowClass||this.isActive()||this.addShadow(),this.$element.css({height:"height"===this.settings.limitType?s:t+parseInt(this.settings.scrollerHeight,10)+parseInt(this.settings.tollerance,10),overflowY:"arrows"===this.settings.scrollMethod?"hidden":"scroll"})),this.$element.data("is-active",!0)}},{key:"isActive",value:function(){return this.$element.data("is-active")}},{key:"getTargetHeight",value:function(){var s=0;if("height"===this.settings.limitType)s=parseInt(this.$element.height(),10);else{var e=this.$element.children("li");if(0!==this.settings.listCount&&this.settings.listCount<e.length)for(var i=0;i<this.settings.listCount;i++)s+=t(e[i]).outerHeight(!0)}return s}},{key:"createWrap",value:function(){this.$element.wrap('<div class="'+this.settings.wrapClass+'"/>'),this.container=this.$element.closest("."+this.settings.wrapClass)}},{key:"updateArrowsState",value:function(t){var s=this.container.find(".arrow-up"),e=this.container.find(".arrow-down");"bottom"===t?s.addClass(this.settings.arrows.disabledClass):s.removeClass(this.settings.arrows.disabledClass),"top"===t?e.addClass(this.settings.arrows.disabledClass):e.removeClass(this.settings.arrows.disabledClass)}},{key:"appendArrows",value:function(){var s='<a class="arrow-up '+this.settings.arrows.up.class+'"><i class="'+this.settings.arrows.up.icon+'"></i></a>',e='<a class="arrow-down '+this.settings.arrows.down.class+'"><i class="'+this.settings.arrows.down.icon+'"></i></a>',i=t("<p>").attr("class","text-center");i.append(t(s)).append(t(e)),this.container.append(i),this.updateArrowsState("top")}},{key:"addShadow",value:function(){this.container.append('<div class="'+this.settings.bottomShadowClass+'"></div>')}},{key:"bindArrowActions",value:function(){this.container.on("click",".arrow-up",{self:this,direction:"up"},this.scrollList),this.container.on("click",".arrow-down",{self:this,direction:"down"},this.scrollList)}},{key:"scrollList",value:function(t){t.preventDefault();var s=t.data.self,e=t.data.direction,i="up"===e?s.$element.scrollTop()+s.$element.height():s.$element.scrollTop()-s.$element.height(),n=void 0;s.$element.animate({scrollTop:i},400,function(){n="up"===e?i+s.$element.height()>=s.$element[0].scrollHeight?"bottom":null:i<=0?"top":null,s.updateArrowsState(n)})}}]),e}();t.fn.listScroll=function(s){var i=this;return this.each(function(){t.data(i,"plugin_listScroll")||t.data(i,"plugin_listScroll",new e(i,s))})}}(jQuery);

/* - ++theme++bootstrap/js/plugins/haiku/jquery.listsearch.js - */
// https://www.psy.ox.ac.uk/portal_javascripts/++theme++bootstrap/js/plugins/haiku/jquery.listsearch.js?original=1
;(function($,window,document,undefined){'use strict';var pluginName='listSearch',defaults={items:'',sortBy:'',groupBy:''};
function Plugin(element,options){this.element=element;this.$element=$(this.element);this.settings=$.extend({},defaults,options);this._defaults=defaults;this._name=pluginName;this.items=[];this.filtered=[];this.groups=[];this.filteredBy={};this.init()}
$.extend(Plugin.prototype,{init: function(){if(!this.settings.groupBy||!this.settings.items){console.log('Invalid list!');return}
this._setupGroups();this._applyFilters(true)},_setupGroups: function(){var _this=this,els=$(this.$element.children(_this.settings.groupBy));$.each(els, function(idx,el){_this.groups.push({el:$(el),items:$(el).find(_this.settings.items),filtered:$(el).find(_this.settings.items)})})},_applyFilters: function(fresh){var _this=this;$.each(_this.groups, function(idx,group){group.filtered=fresh||Object.keys(_this.filteredBy).length===1?group.items:group.filtered;for(var filter in _this.filteredBy){if(typeof _this.filteredBy[filter]==='function'){group.filtered=_this._filter(group.filtered,_this.filteredBy[filter])}}});this.displayItems()},_sort: function(items){var _this=this;if(items.length){items.sort(function(a,b){var aName=$(a).find(_this.settings.sortBy).text().toLowerCase(),bName=$(b).find(_this.settings.sortBy).text().toLowerCase();return aName<bName?-1:aName>bName?1:0})}
return items},_filter: function(array,filterFunc){var index=-1,length=array.length,resIndex=-1,result=[];while(++index<length){var value=array[index];if(filterFunc(value)){result[++resIndex]=value}}
return result},filter: function(filter){this.filteredBy[filter.id]=filter.filter;this._applyFilters()},displayItems: function(){var _this=this,noPeople='There are no people matching your selection.',html,ignore;$.each(this.groups, function(idx,group){html=group.filtered.length?_this._sort($.unique(group.filtered)):noPeople;ignore=_this.settings.ignore?group.el.find(_this.settings.ignore):null;group.el.empty().append(ignore).append(html)})},resetFilter: function(name){delete this.filteredBy[name];this._applyFilters(true)}});$.fn[pluginName]=function(options){return this.each(function(){if(!$.data(this,'plugin_'+pluginName)){$.data(this,'plugin_'+pluginName,new Plugin(this,options))}})}})(jQuery,window,document);

/* - ++theme++bootstrap/js/plugins/haiku/jquery.list.js - */
// https://www.psy.ox.ac.uk/portal_javascripts/++theme++bootstrap/js/plugins/haiku/jquery.list.js?original=1
"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();!function(t){var i={items:[],fixedFilters:[],pagination:{container:"",limit:20},messages:{noMatch:"There are no matching items.",endOfList:"No more items to show."},messagesClass:"details",events:{}},e={};e.lastIndexOf=function(t,i){var e=t?t.length:0;if(!e)return-1;for(var s=e;s--;)if(t[s]===i)return s;return-1},e.union=function(t,i){for(var e=t.concat(i),s=0;s<e.length;++s)for(var n=s+1;n<e.length;++n)e[s]===e[n]&&e.splice(n--,1);return e},e.filter=function(t,i){for(var e=-1,s=t.length,n=-1,o=[];++e<s;){var a=t[e];i(a)&&(o[++n]=a)}return o},e.updateWindowLocation=function(t,i){var s=location.protocol+"//"+location.host+location.pathname;Object.keys(t).length>0&&(s+="?",Object.keys(t).forEach(function(n){void 0===e.find(n,i,"id")&&(s+=n+"="+t[n].value+"&")})),window.history.replaceState({},document.title,s)},e.guid=function(){return function t(i){return i?(i^16*Math.random()>>i/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()},e.find=function(t,i,e){for(var s=0;s<i.length;s++)if(i[s][e]===t)return i[s]};var s=function(){function s(e,n){_classCallCheck(this,s),this.element=e,this.$element=t(e),this.settings=t.extend({},i,n),this.settings.pagination=t.extend({},i.pagination,n.pagination,{startkey:0,finished:!1}),this.settings.displayItems=[],this.settings.filteredItems=[].concat(this.settings.items),this.settings.filteredBy={},this.init()}return _createClass(s,[{key:"init",value:function(){this.setup(),this.setupFixedFilters(),this.applyFilters(),this.bindActions()}},{key:"setup",value:function(){this.settings.guid=e.guid(),this.setupHtml(),this.replacePagination()}},{key:"setupFixedFilters",value:function(){if(this.settings.fixedFilters.length>0)for(var t=0;t<this.settings.fixedFilters.length;t++)this.filter(this.settings.fixedFilters[t])}},{key:"setupHtml",value:function(){var i=t("<div>").attr("id","haikulist_"+this.settings.guid+"_items-container"),e=t("<div>").attr({class:"infinite-scroll-button-holder",id:"haikulist_"+this.settings.guid+"_load-more-button-container"});this.$element.empty().append(i).append(e),this.settings.itemsContainer=t("#haikulist_"+this.settings.guid+"_items-container"),this.settings.loadMoreButtonContainer=t("#haikulist_"+this.settings.guid+"_load-more-button-container")}},{key:"resetList",value:function(){this.settings.itemsContainer.empty(),this.settings.pagination.startkey=0,this.settings.pagination.finished=!1}},{key:"updateLoadMoreButtonText",value:function(){var t=this.settings.filteredItems.length-this.settings.displayItems.length,i=t>this.settings.pagination.limit?this.settings.pagination.limit:t,e="Load "+i+" more";this.settings.loadMoreButton.text(e)}},{key:"replacePagination",value:function(){var i=t("<a>").text("Loading...").attr({id:"haikulist_"+this.settings.guid+"_load-more",href:"#",class:"link-button"}),e=t("<p>").attr({id:"haikulist_"+this.settings.guid+"_finished",class:this.settings.messagesClass}),s=t("<a>").text("Go to top").attr({id:"haikulist_"+this.settings.guid+"_scroll-top",class:"btn btn-sm btn-default"}).css({position:"fixed",bottom:"0px",right:"20px"});t(this.settings.pagination.container).hide(),this.settings.loadMoreButtonContainer.append('<div class="clearfix"></div>').append(i).append(e).append(s),this.settings.loadMoreButton=t("#haikulist_"+this.settings.guid+"_load-more").hide(),this.settings.finishedMessage=t("#haikulist_"+this.settings.guid+"_finished").hide(),this.settings.scrollTopButton=t("#haikulist_"+this.settings.guid+"_scroll-top").hide()}},{key:"loadMore",value:function(t){var i=function(t,i,e){return t.length>e?t.slice(i,i+e):t}(this.settings.filteredItems,this.settings.pagination.startkey,this.settings.pagination.limit),s=e.lastIndexOf(this.settings.filteredItems,i[i.length-1]);this.settings.showMessages=this.settings.pagination.startkey>0,-1!==s?(this.settings.pagination.startkey=s+1,this.settings.displayItems=e.union(this.settings.displayItems,i),this.settings.displayItems.length===this.settings.filteredItems.length&&(this.settings.pagination.finished=!0),this.appendItemsToView(i,t)):this.settings.pagination.finished=!0,this.updateLoadMoreButtonText(),this.toggleLoadMoreButtonVisibility(),this.toggleMessagesVisibility(),this.updateItemCount()}},{key:"appendItemsToView",value:function(t,i){for(var e=this.settings.itemsContainer.children().last(),s=0;s<t.length;s++)this.settings.itemsContainer.append(t[s].html);i&&this.animateScroll(e)}},{key:"animateScroll",value:function(){var i=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t("body"),s=e.offset().top;t("body, html").animate({scrollTop:s},1e3,function(){i.toggleScrollTopVisibility(s)})}},{key:"toggleScrollTopVisibility",value:function(i){i>t(window).height()-this.$element.offset().top?this.settings.scrollTopButton.show():this.settings.scrollTopButton.hide()}},{key:"toggleLoadMoreButtonVisibility",value:function(){this.settings.pagination.finished?this.settings.loadMoreButton.hide():this.settings.loadMoreButton.show()}},{key:"toggleMessagesVisibility",value:function(){var t=void 0;this.settings.pagination.finished&&(0===this.settings.displayItems.length&&(t=this.settings.messages.noMatch),this.settings.showMessages&&this.settings.displayItems.length>0&&(t=this.settings.messages.endOfList)),t?this.settings.finishedMessage.text(t).show():this.settings.finishedMessage.hide()}},{key:"updateItemCount",value:function(){var t=void 0,i=void 0;"function"==typeof this.settings.events.updateItemCount&&(i=this.settings.filteredItems.length===this.settings.items.length,t=this.settings.filteredItems.length,this.settings.events.updateItemCount(t,i))}},{key:"applyFilters",value:function(t){var i=this;this.settings.displayItems=[],(Object.keys(this.settings.filteredBy).length<2||t)&&(this.settings.filteredItems=[].concat(this.settings.items)),Object.keys(this.settings.filteredBy).forEach(function(t){"function"==typeof i.settings.filteredBy[t].filter&&(i.settings.filteredItems=e.filter(i.settings.filteredItems,i.settings.filteredBy[t].filter),void 0===e.find(t,i.settings.fixedFilters,"id")&&e.updateWindowLocation(i.settings.filteredBy,i.settings.fixedFilters))}),this.resetList(),this.loadMore()}},{key:"filter",value:function(t,i){var e=void 0===i?void 0!==this.settings.filteredBy[t.id]:i;this.settings.filteredBy[t.id]={filter:t.filter,value:t.value},this.applyFilters(e)}},{key:"resetFilter",value:function(t){delete this.settings.filteredBy[t],this.applyFilters(!0)}},{key:"bindActions",value:function(){var i=this;this.settings.loadMoreButton.on("click",function(t){t.preventDefault(),i.loadMore(!0)}),this.settings.scrollTopButton.on("click",function(t){t.preventDefault(),i.animateScroll()}),t(window).scroll(function(){i.toggleScrollTopVisibility(t(window).scrollTop())})}}]),s}();t.fn.haikuList=function(i){var e=this;return this.each(function(){t.data(e,"plugin_haikuList")||t.data(e,"plugin_haikuList",new s(e,i))})}}(jQuery);

/* - ++theme++bootstrap/js/plugins/haiku/turnkey-jobs-feed.js - */
// https://www.psy.ox.ac.uk/portal_javascripts/++theme++bootstrap/js/plugins/haiku/turnkey-jobs-feed.js?original=1
"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}();!function(e){var t={feedUrl:null,keys:["html_description","salary","closes","webpage","label","url","contact","location"]},n=function(){function n(a,r){_classCallCheck(this,n),this.element=a,this.$element=e(a),this.settings=e.extend({},t,r),this.init()}return _createClass(n,[{key:"init",value:function(){var e=this,t=arguments;this.url=this.formatUrl(),this.fetch().fail(function(t,n,a){e.handleError(t.status+": "+a)}).done(function(n){n&&(n.vacancies.length?(e.buildResults(n.vacancies),e.setUpAccordion()):e.setupEmptyVacancies(),"function"==typeof e.settings.onComplete&&e.settings.onComplete.apply(e.vacancies,t))})}},{key:"formatUrl",value:function(){this.settings.feedUrl;var e=this.settings.feedUrl.substr(1+this.settings.feedUrl.lastIndexOf("/")).split("?")[0],t=-1!==e.lastIndexOf(".")?e.substr(e.lastIndexOf(".")):null,n=this.settings.feedUrl;return null!=t&&(n=n.substr(0,n.length-t.length)),n+=".json"}},{key:"fetch",value:function(){return e.ajax({type:"GET",crossDomain:!0,url:this.url,dataType:"json"})}},{key:"buildResults",value:function(t){var n=this;this.vacancies=e.map(t,function(t){var a=function(t){return-1!==e.inArray(t,n.settings.keys)},r=function(e,n){return e[n]=t[n],e};return Object.keys(t).filter(a).reduce(r,{})})}},{key:"setUpAccordion",value:function(){for(var t=this,n="",a=this.constructor.generateAccordionId(),r=e("<div/>",{class:"job-accordion"}),s=function(e,n,a){return'<div class="panel-heading"><a class="panel-title" data-toggle="collapse" data-parent="#job-accordion-'+e+'" href="#acc-'+e+"-"+a+'">'+n.label+"</a><p>Closing Date: "+t.constructor.formatDate(n.closes)+" | "+n.salary.label+"</p></div>"},i=function(e,t,n,a){return'<div id="acc-'+e+"-"+n+'" class="panel-collapse collapse '+a+'">\n          <div class="panel-body">'+t.html_description+'\n            <p><a href="'+t.webpage+'" class="btn btn-primary" target="_blank" rel="noopener">More information</a></p>\n          </div>\n        </div>'},l=0;l<this.vacancies.length;l++){var c=function(e){return{label:e.label||"Vacancy",closes:e.closes||"",salary:e.salary||{label:"not specified"},html_description:e.html_description||"",webpage:e.webpage||""}}(this.vacancies[l]);n+=function(e,t,n,a){return'<div class="panel panel-default">'+s(e,t,a)+i(e,t,a,n)+"</div>"}(a,c,"",l)}this.$element.hide(),r.addClass("panel-group").attr("id","job-accordion-"+a).html(n),this.$element.after(r)}},{key:"setupEmptyVacancies",value:function(){var t=e("<div/>",{class:"alert alert-box alert-info"});t.html("There are no open vacancies at the moment."),this.$element.hide(),this.$element.after(t)}},{key:"handleError",value:function(t){var n=(this.settings.feedUrl,e("<p />").attr("class","alert alert-warning").text("We couldn't find any vacancies at the moment. Please check back again!"));this.$element.hide().after(n)}}],[{key:"generateAccordionId",value:function(){return function e(t){return t?(t^16*Math.random()>>t/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()}},{key:"formatDate",value:function(e){var t="";if(e){t=new Date(e).toString()}return t}}]),n}();e.fn.queryJobsFeed=function(t){var a=this;return this.each(function(){e.data(a,"plugin_queryJobsFeed")||e.data(a,"plugin_queryJobsFeed",new n(a,t))})}}(jQuery);
